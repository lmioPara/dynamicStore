!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.dynamicStore=t():e.dynamicStore=t()}(window,(function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);var r={treeDelimiter:"$",setDeep:!0,debugger:!1,arrayConversion:!1,chainConversion:!1,userExternalObject:!1,mutationController:["set"],controllerDecorator:"@",snapShot:3e3,persistence:!1,persistenceStorage:"localStorage",persistenceStoragePrefix:"ds_"};const n={set:{fn:(e,t,i,r)=>{if(e[t]=i,r.chainConversion&&t.indexOf(r.treeDelimiter)>0){t.split(r.treeDelimiter).reduce((e,t,r,n)=>(r===n.length-1&&(e[t]=i),e[t]),e)}}},snap:{fn:(e,t,i,r)=>{let n=e[t];e[t]=i,setTimeout(()=>{e[t]=n},r.snapShot)}},persistence:{fn:(e,t,i,r)=>{if(n.set.fn(e,t,i,r),console.log("[DS persistence] 持久化数据"),r.persistence){let e=`${r.persistenceStoragePrefix}${t}`;switch(r.persistenceStorage){case"localStorage":localStorage.setItem(e,JSON.stringify(i));break;case"sessionStorage":sessionStorage.setItem(e,JSON.stringify(i));break;default:console.warn("[DS persistence error] 未设置持久化类型")}}}}};var o=(e,t="set")=>function(i,r){this.config.debugger&&console.log(`[DS mutation] ${e} ${t}`,i,r,this.config),n[t].fn(i,e,r,this.config)};var s=e=>async function(t,i){this.config.debugger&&console.log("[DS action] "+e,t,i,this.config),await this.config.actions[e](t,i,this.config)};var c=e=>function(t,i,r){return this.config.debugger&&console.log("[DS getters] "+e),t[e]};t.default=class{constructor(e,t){this.state=e,this.config={...r,...t},this.state=this.conversion(this.state)}conversion(e,t=""){let i=Object.keys(e),r={};return i.map(i=>{if(this.config.chainConversion&&i.indexOf(this.config.treeDelimiter)>=0)throw new Error(`state中不能使用 [${this.config.treeDelimiter}] 连接符  问题key: [${i}] 前缀: [${t}]`);let n,o=`${t}${i}`;if(n=this.config.persistence?this.initStorageValue(o,e[i]):JSON.parse(JSON.stringify(e[i])),"[object Object]"===Object.prototype.toString.call(n)){if(r[o]=n,this.config.chainConversion){let e=this.conversion(n,`${o}${this.config.treeDelimiter}`);Object.assign(r,e)}}else if("[object Array]"===Object.prototype.toString.call(n)&&this.config.arrayConversion){if(r[o]=n,this.config.chainConversion){let e=this.conversion(n,`${o}${this.config.treeDelimiter}`);Object.assign(r,e)}}else r[o]=n}),r}getMutations(){let e={};return Object.keys(this.state).map(t=>{e[t]=o(t).bind(this),this.config.mutationController.map(i=>{"set"!==i&&(e[`${t}${this.config.controllerDecorator}${i}`]=o(t,i).bind(this))})}),e}getGetters(){let e={};return Object.keys(this.state).map(t=>{e[t]=c(t).bind(this)}),e}getState(){return this.state}getActions(){if(this.config.actions){let e={};return Object.keys(this.config.actions).map(t=>{e[t]=s(t).bind(this)}),e}return{}}initStorageValue(e,t){if(this.config.persistence){let i,r=`${this.config.persistenceStoragePrefix}${e}`;switch(this.config.persistenceStorage){case"localStorage":i=localStorage.getItem(r);break;case"sessionStorage":i=sessionStorage.getItem(r);break;default:throw new Error("[DS persistence error] 未设置持久化类型")}return i?JSON.parse(i):t}}exportModule(){return{namespaced:!0,state:this.getState(),actions:this.getActions(),getters:this.getGetters(),mutations:this.getMutations()}}}}])}));